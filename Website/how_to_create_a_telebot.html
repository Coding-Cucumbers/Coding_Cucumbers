<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>How to Create a Telebot With Python [Part 2] - Coding Cucumbers</title>
    <meta name="description" content="Tutorial on building a telegram bot with python, deep dive into the fundamental codes that will allow your bot to function, explanations at every step">
    <meta name="Bryan">
    <link rel="icon" href="../resources/logos/CC_logo_no_words.png">

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script data-ad-client="ca-pub-6525626618604810" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <link rel="stylesheet" type="text/css" href="../CSS/blogpost.css">
    <link rel="stylesheet" type="text/css" href="../CSS/footer.css">
    <link rel="stylesheet" type="text/css" href="../CSS/header.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Raleway&family=Bungee&family=Bungee+Shade&family=Exo:wght@600&family=Ubuntu:wght@500&family=Poppins:wght@300&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9WZBXGQYRN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-9WZBXGQYRN');
    </script>
    <link rel="canonical" href="https://www.codingcucumbers.com/website/how_to_create_a_telebot" />
</head>

<body>

  <script language="javascript" type="text/javascript"
    src="header.txt"></script>

<div class="container-fluid main_container_box">
    <div class="row main_row">
        <div class="col-3"></div>

        <div id="main_post" class="col-6">
            <div class="title_box">
                <h1 class="title">How to Create a Telebot With Python [Part 2]</h1><br>
                <p class="preamble">Get Right into the Code</p>
            </div>

            <div class="author">
                <container class="author_container">
                  <div class="img_cropper">
                    <img src="../resources/about_us/bryan_coding_cucumbers_aboutus.jpg" id="author_img" alt="author bryan image">
                  </div>
                    <div class="author_details">
                        <p class="author_name">Bryan Ho</p>
                        <p class="date">24th June 2021</p>
                    </div>
                </container>

                <container class="socials">
                    <a href="https://www.instagram.com/badboibrybryy/">
                        <img src="../resources/socials/instagram-no-bg.png" alt="instagram icon">
                    </a>
                    <a href="https://github.com/bryanhce">
                        <img src="../resources/socials/github_icon.png" alt="github icon">
                    </a>
                    <a href="https://www.linkedin.com/in/bryan-ho-7271b91b4/">
                        <img src="../resources/socials/linkedin-no-bg.png" alt="linkedin icon">
                    </a>
                    <a>
                        <img src="../resources/socials/email_icon.png" class="bryan_gmail" alt="email icon">
                    </a>
                </container>
            </div>
            <img src="../resources/post_pictures/post_posters/how_to_create_telebot_p2-min.jpg" alt="How to Create a telebot with python" class="blog_post_img"><br>

            <container id="main_container">
                <p class="signposting">Introduction</p>
                <p class="text">
Welcome back to the 2nd iteration of this 3 part series on building your very own telegram bot! We will be building on the existing knowledge from the <a href="../Website/complete_guide_to_building_a_telegram_bot.html" target="_blank">previous article</a>, so check it out before proceeding on to better understand the contents of this
article. </p>
                <p class="text">
                    In this article, I will be sharing some key functions that will cement the foundation of your bot. These functions below help to construct the URLs to execute specific functions. Although the succeeding lines of code are in python, I will extract the logic of the code for others who would like to build a bot in another language. Well, let’s jump right in with python
                    code!
                </p>

                <container class="content_box text">
                    <p class="content_title">Content Page</p>
                    <ol class="content_list">
                        <a href="#first_link">
                            <li>Imports and Constants</li>
                        </a>

                        <a href="#second_link">
                            <li>Receive Updates</li>
                        </a>

                        <a href="#third_link">
                            <li>Get Chat ID</li>
                        </a>

                        <a href="#fourth_link">
                            <li>Get Text Message</li>
                        </a>

                        <a href="#fifth_link">
                            <li>Send Message</li>
                        </a>

                        <a href="#sixth_link">
                            <li>Bringing It Together</li>
                        </a>

                      </ol>
                </container>
                <img src="../resources/post_pictures/inside_post_pictures/telegram_bot_p2/telebot-pic1-part2-min.jpg" alt="Python and Telegram Bot" class="inside_post_img"> <br><br>

                <container class="main_text text">
                    <a id="first_link">
                        <h2 class="signposting">Imports and Constants</h2>
                    </a>
                    <pre><code>
import json
import requests
import urllib
                    </pre></code>
                    <p>Import the packages that will be needed to build this telegram bot. “requests” library allows you to easily make HTTP requests over the web. “json” library helps with parsing JSON type into a Python dictionary type, which makes the data from our HTTP requests python “readable”. I see it as a translator of sorts. But of course, the descriptions were an oversimplification of what these packages can actually
                      do.</p>
                      <pre><code>
# Bot's token for authentication with Telegram API
token = '{your token}’
# Basic URL for created Telegram bot
URL = "https://api.telegram.org/bot{}/".format(token)
                      </pre></code>

                    <p>This declares some important variables that are used to construct a variety of URLs for the many functions of our telegram bot.</p>

                    <a id="second_link">
                        <h2 class="signposting">Get Updates Function</h2>
                    </a>
                    <pre><code>
def get_updates():
    url = URL + "getUpdates"
    response = requests.get(url)
    decode_response = response.content.decode("utf8")
    updates = json.loads(decode_response)
    return updates
                    </pre></code>
                    <p>This function builds the get updates URL, by adding the “getUpdates” behind our base url. In the 3rd line, we send a HTTP GET request and the response is stored in the “response” variable that is then decoded. The decoded response which is stored in the “decoded_response” variable is then parsed (you can think of it as being transformed) from json type into python dictionary type and finally returned as “updates”. Just to clarify, the updates in this case are all the messages that all users have sent to the telegram bot in the past 24 hours.
                    </p>

                    <a id="third_link">
                        <h2 class="signposting">Get Chat ID Function</h2>
                    </a>
                    <pre><code>
def get_last_chat_id(updates):
    num_updates = len(updates["result"])
    last_update = num_updates - 1
    chat_id = updates["result"][last_update]["message"]["chat"]["id"]
    return chat_id
                    </pre></code>

                    <p>This function takes the output of get_Updates (which is the parameter “updates”) and takes the last message that was sent to the telebot, grabs it’s chat ID and returns it. “num_updates” stores the number of messages that were sent to the telegram bot in the last 24 hours. This seems odd, wouldn’t the “num_updates” then be the index of the latest message? Why are we deducting 1 from that number and storing it into “last_update”? This is because the indexing of a dictionary starts from 0 and not 1, as such we need to account for this difference in “counting convention” by deducting
                      1.</p>
                    <p>We then traverse the update dictionary as per ["result"][last_update]["message"]["chat"]["id"] that will then reference the chat ID of the last message and return it in the variable “chat_id”. Note that <mark>“result” is actually a list</mark> and by using the number stored inside “last_update”, you are actually indexing the
                      list.</p>
                      <pre><code>
    {
     "ok":true,
     "result":[
        {
           "update_id":"xxxxx",
           "message":{
              "message_id":10,
              "from":{
                 "id":"xxxxx",
                 "first_name":"bryan",
                 "last_name":"ho"
              },
              "chat":{
                 "id":24860000,
                 "first_name":"bryan",
                 "last_name":"ho",
                 "type":"private"
              },
              "date":1671080423,
              "Text":"last_message!!"
           ]
        }
                      </pre></code>
                    <p> For pictorial representation, here is the dictionary. FYI I used a JSON beautifier, which is immensely helpful when you want to get a clear representation of a dictionary which has many embedded dictionaries such as the
                      below.</p>

                       <a id="fourth_link">
                           <h2 class="signposting">Get Last Text Function</h2>
                       </a>
                       <pre><code>
 def get_last_text(updates):
     num_updates = len(updates["result"])
     last_update = num_updates - 1
     text = updates["result"][last_update]["message"]["text"]
     return text
                       </pre></code>
                       <p>The logic behind get_last_text function is almost identical to that of get_last_chat_id function. Instead of grabbing the chat_id, we are taking the text. This logic can be applied to any field you would like to use such as the “first_name” and “last_name”
                         fields.</p>

                         <a id="fifth_link">
                             <h2 class="signposting">Send Message Function</h2>
                         </a>
                         <pre><code>
def send_message(text, chat_id):
   url = URL + "sendMessage?text={}&chat_id={}".format(text, chat_id)
   get_url(url)
                         </pre></code>
                         <p>This function sends a message back to a specified user via the telebot by once again building the specific URL with the parameters. It takes in 2 parameters, text which is the message that you would like the telebot to send and the chat_id of the
                           user.</p>

                           <a id="sixth_link">
                               <h2 class="signposting">Main Function</h2>
                           </a>
                           <pre><code>
 def main():
     updates = get_updates()
     user_chat_id = get_last_chat_id(updates)
     user_last_text = get_last_text(updates)

     if user_last_text == “\start”:
        send_message(“Welcome to my first bot!”, user_chat_id)

 if __name__ == '__main__':
     main()
                           </pre></code>
                           <p>Bringing it all together, run these lines of code in your main. If the last message sent to the telegram bot is “\start”, the bot will reply to that user “Welcome to my first bot!”. The if __name__ == ‘__main__’ is a pythonic convention that is used to execute some code only if the file was run directly, and not
                             imported.</p>
                             <p>And that’s a wrap, you’ve built your very own telegram bot! Of course, this is by no means very functional, but is it the fundamental building block, a canvas, that you can add your own logic and functions to and create your dream
                               bot!</p>

                 <img src="../resources/post_pictures/inside_post_pictures/telegram_bot_p2/telebot-pic2-part2-min.jpg" alt="python and telegram pic" class="inside_post_img"> <br><br>

                 <container class="content_box text">
                     <p class="content_title">Notes About this Bot</p>
                     <ol class="content_list">
                             <li>The script must be <mark>run from your local</mark> everytime you want the bot to send and reply messages. You would need to consider a hosting platform to house your code so that the telebot is able to function 24/7. Some free hosting platforms include PythonAnywhere, Google Cloud Platform and
                               Heroku.</li>
                             <li>The data (the one seen in the browser) from the get_updates() function will be lost after 24 hours. As such, you will not be able to use data analytics tools to analyze your data and drive any necessary insights. One way to circumvent this problem is to set up a database to store the data that you have collected. Some free database platforms include Postgres for SQL Database and mongoDB for NoSQL
                               Database.</li>
                             <li>There are major problems with the get_updates() function. Firstly, the script throws an error if there are no new updates. Secondly, it returns all the messages that were sent to the bot in the past 24 hours, even the ones that you have already “processed”, which is not efficient and useful. Thirdly, it does not automatically get updates when new messages are
                               sent.</li>
                             <li>This bot does not utilise 3rd party python packages that can actually make building your telebot much
                               simpler.</li>
                       </ol>
                 </container>

                    <h2 class="signposting">Conclusion</h2>
                    <p>
                      Luckily, in the 3rd part of this series, I will be going through some of the problems mentioned above to make our telegram bot more robust and functional. We will explore 3rd party packages in detail, build inline keyboards, message callbacks and
                      more.</p>
                      <p>Hope this article proved useful to you and if it was, do share it with your friends! Your support means a lot to us! Thank you and stay cool
                        Cucumbers!</p>
                </container>
            </container>


        </div>



<!-- newsletter popup -->
<script language="javascript" type="text/javascript" src="newsletter.txt"></script>

        <div class="col-1"></div>
    </div>

</div>
<br><br><br><br>

<script src="../Website_JS/blogpost.js"></script>
<script language="javascript" type="text/javascript" src="footer.txt"></script>
</body>
</html>
